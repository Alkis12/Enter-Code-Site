# API Абонементов

## Описание

Система абонементов позволяет управлять доступом студентов к занятиям. У каждого студента есть:
- Статус абонемента (оплачен/не оплачен/истек)
- Количество оставшихся занятий

## Эндпойнты

### 1. Продление абонемента
**POST** `/subscription/extend`

Позволяет преподавателям и администраторам продлевать абонемент студентам.

**Тело запроса:**
```json
{
  "user_id": "674a1b2c3d4e5f6789012345",
  "lessons_count": 10,
  "access_token": "teacher_access_token"
}
```

**Ответ:**
```json
{
  "message": "Абонемент пользователя Иван Иванов успешно продлен на 10 занятий",
  "success": true
}
```

### 2. Информация об абонементе
**POST** `/subscription/info`

Получить информацию о текущем статусе абонемента.

**Тело запроса:**
```json
{
  "user_id": "674a1b2c3d4e5f6789012345",
  "access_token": "user_access_token"
}
```

**Ответ:**
```json
{
  "user_id": "674a1b2c3d4e5f6789012345",
  "subscription_status": "paid",
  "lessons_remaining": 8,
  "has_valid_subscription": true
}
```

### 3. Списание занятия
**POST** `/subscription/use-lesson`

Позволяет преподавателям списывать занятия у студентов.

**Тело запроса:**
```json
{
  "user_id": "674a1b2c3d4e5f6789012345",
  "access_token": "teacher_access_token"
}
```

**Ответ:**
```json
{
  "message": "Занятие успешно списано у Иван Иванов. Осталось занятий: 7",
  "success": true
}
```

### 4. Проверка действительности абонемента
**GET** `/subscription/check-validity/{user_id}`

Быстрая проверка, действителен ли абонемент студента.

**Тело запроса:**
```json
{
  "access_token": "user_access_token"
}
```

**Ответ:**
```json
{
  "user_id": "674a1b2c3d4e5f6789012345",
  "is_valid": true,
  "lessons_remaining": 7,
  "status": "paid"
}
```

## Обновленный профиль пользователя

Теперь при запросе профиля студента (`/users/profile`) в ответе также содержится информация об абонементе:

```json
{
  "id": "674a1b2c3d4e5f6789012345",
  "name": "Иван",
  "surname": "Иванов",
  "tg_username": "ivan_student",
  "user_type": "student",
  "status": "active",
  "phone": "+7900123456",
  "avatar_url": null,
  "bio": "Студент курса программирования",
  "subscription_status": "paid",
  "lessons_remaining": 7
}
```

## Логика работы с абонементом

1. **Продление абонемента**: Добавляет указанное количество занятий
2. **Использование занятия**: Уменьшает количество оставшихся занятий на 1
3. **Автоматическое изменение статуса**: Когда занятия заканчиваются, статус меняется на "expired"
4. **Проверка действительности**: Учитывает количество занятий и статус

## Права доступа

- **Студенты**: Могут просматривать только свою информацию об абонементе
- **Преподаватели**: Могут просматривать, продлевать абонементы и списывать занятия у всех студентов
- **Администраторы**: Полный доступ ко всем функциям
